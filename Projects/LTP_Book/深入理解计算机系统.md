# 深入理解计算机系统

## 计算机系统的漫游

信息= 位+上下文

文件是对IO设备的抽象，虚拟存储器是对磁盘和主存的抽象，进程是对处理器，主存，IO的抽象

存储层次结构： 远程服务器存储-》本地磁盘-》主存DRAM-》高速缓冲SRAM-》寄存器

internet 将一台主机的信息复制到另外一台主机

让计算机做的更多，让计算机运行的更快

## 信息的表示和处理

1. 信息存储

    2，10，16进制**表示**

    1个字节由8位组成

    地址大小：字长-----32，64位-----虚拟地址空间的最大值

    数据大小：就是使用几个地址

    布尔代数-----C语言支持按位布尔运算---或，与，反，异或

    -------------C语言支持逻辑运算，移位运算
2. 整数表示

    用什么编码方式取决于操作系统和编译器

    无符号数编码---也可以用补码表示

    有符号数编码---补码--- （还有原码和反码表示）---现代计算机用补码表示整数

    正数的原码=补码=反码
3. 整数运算

    算力有限导致的溢出----------补码的加减乘除
4. 浮点数

    IEEE754标准  单精度 1-8-23  双精度 1-11-52

    $$
    (-1)^{s}*M*2^{E}
    $$

   规格化和非规格化（阶码全0，即E=000...）

5. 浮点数运算

## 程序的机器级表示

寄存器：数据和指针（地址）

操作数寻址： 立即数（常数），寄存器（寄存器名称），存储器引用（内存地址）

程序栈存放在存储器中某个区域，后进先出

汇编代码： mov , push ,pop, 算术和逻辑操作，

                  控制（条件set(条件码寄存器：进位，零，符号，溢出)，跳转jmp，循环，转移Call）

‍

 一个过程调用包括将数据（以过程参数和返回值的形式）和控制从代码的一部分传递到另一部分。

过程调用就是函数调用，main函数是所有的函数的入口，函数调用用到栈的概念。

面向对象的对象用到堆的概念。

## 处理器体系结构

指令集模拟器

每个指令在CPU里面都是原子指令（唯一且不可分割）

逻辑门-----组合电路-----硬件控制语言HCL（电路设计）

组合电路不存储任何信息，只是响应输入信号，产生等于输入的某个函数的输出。

时序电路----高低电位

ALU算术逻辑单元是一种很重要的逻辑电路

处理一条指令：

* 取指（从存储器读取程序计数器（PC）地址里面的值）
* 译码
* 执行
* 访存
* 写回
* 更新PC

流水线--------------增加系统吞吐量

## 优化程序性能

高效程序：合适的算法和数据结构，编写编译器可优化的高效可执行代码，将一个任务分成多个任务并行计算

理想的情况是，编译器能够接受我们编写的任何代码并产生尽可能高效的，具有指定行为的机器级程序。

## 存储器层次结构

磁盘容量=字节数*扇区数 *磁道数 * 表面数 * 盘片数 * 磁盘数

数据流通过总线（地址，数据总线，控制信号）在处理起和主存之间读写。

局部性原理

## 链接

将各种代码和数据收集组合成一个单一文件的过程，这个文件可被加载到存储器并执行。发生的阶段有编译时，加载或运行时 。链接使分离编译成为可能，减少没有更改部分的重新编译。链接可以在编译时由静态编译器完成，也可以在加载或者运行时由动态链接器完成。

链接器主要任务: 符号解析和重定位.

编译驱动程序（各种语言）包括预处理器，编译器，汇编器，链接器

![image.png](image-20220517161003-jecly5q.png)

目标文件：编译器和汇编器生成可重定位的目标文件，链接器生成可执行的目标文件

静态库和动态共享库

加载器将可执行目标文件中的代码和数据从磁盘拷贝到存储器中，然后通过跳转到程序的入口来运行该程序。

存储器映像

![image.png](image-20220517210110-pjfey8u.png)

	

## 异常控制流

概念 : 程序计数器里面的指令地址不相邻.  如何与硬件和操作系统交互.

系统启动时，OS分配和初始化一张异常表跳转表。表的内容有的是处理器相关的，包括除0，缺页，存储器违法访问，断点，算术溢出。有的是OS内核相关的，包括系统调用和I/O 设备信号。

进程，时间片，用户态和内核态，上下文切换

## 虚拟存储器

虚拟存储器为每一个进程提供一个大的，一致的，私有的地址空间。

CPU通过生成一个虚拟地址，然后翻译成物理地址来访问主存。

段，页，TLB

## 系统级IO

文件

## 网络编程

TCP，IP, 客户服务器

## 并发编程

多线程

‍
