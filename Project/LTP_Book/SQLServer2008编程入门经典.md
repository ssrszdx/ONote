# SQLServer2008编程入门经典

## 目录

sqlserver境界
1.了解关系型数据库和sql

2.掌握存储过程，T-SQL，触发器，事件等

3.TB级海量数据处理

4. BI产品，比如SSIS，SSAS,SSRS,MDX多维数据库，XML/A,LINQ
5. 数据库未来的发展，关系型，多维，面向对象， sql-存储过程，ODBC-LINQ

## 第1-5章

1.数据库实现的功能，存储数据，管理数据，读取数据。RDBMS可以定义数据类型和数据业务规则
2.1个物理服务器如何建立多个sqlserver实例

3。日志是数据进入磁盘的最先位置，数据库是随机访问配置（快速访问），而日志是连续的（发生的事件按顺序跟踪），日志不断积累已确认的更改，并一次将几次更改写入到物理数据库文件。

4.数据库中的表由称为域的数据（列）和实体数据（行）构成

5. 利用索引可以加速数据的查找，索引是针对特定的**表或视图**架构内存在的对象，聚集索引每个表只能有一个，和物理存储数据相同。非聚集索引一个表可以有多个

6.触发器是在**表**操作时自动执行的一段逻辑代码，主要用于输入时复制数据和更新时检查数据，确保数据满足相应的标准。

7，约束是限制表中数据满足某些条件，若违反则拒绝操作数据库

8数据库关系图可以通过ERD图来表示，，实体/关系图，

9.视图可以控制用户所见，实现安全和易于使用，同时通过剪裁视图使用户不必搜索任何不必要的信息。视图以查询的形式存储在数据库中。视图可以引用多个表

10. 索引视图？？？？

11、存储过程比sql的优势在于允许变量和参数，可以使用选择和循环结构

![](0309194d9c88e76142edb7446acf0bdb-20220205112454-px6o4e3.png)

12.![](c84f1b68b09ad2db08553ef358f58160-20220205112454-3s8etry.png)

13。用户和角色之间可以一对多，多对一的映射

14.规则可以用于定义用户自定义类型中的限制条件，规则不限定于特定表，可以绑定到多个表或者特定数据类型

15用户自定义类型是系统自定义类型或者.net程序集中方法定义的复杂数据类型的扩展

即能定义一种数据类型用于存储.net对象可以存储的任意对象，但是代价大

16全文目录用于加速列中特定文本块的搜索。

17![](a9fc9a7da6d4d4d969e248395eecb04a-20220205112454-kdx2l3h.png)

18Null数据，，未定义的值

19![](0d81409c279f5b8342874015240f7d3a-20220205112454-8ct7pcd.png)

服务管理![](eaea267fa6c593ff88a12fbb182ed311-20220205112454-kythm9g.png)

网络管理

![](7e03b4c4db0257a7616ab432d325f42b-20220205112454-gddi62o.png)

在客户机和服务器上相同的NetLib必须都可用，这样他们才可以通过网络协议彼此通信

![](909254ca12a7200b414f1e80447b65bc-20220205112454-3q72x6r.png)

NetLib是sqlserver与某些网络协议通信的的DLL

20.sqlserver management studio 显示执行计划显示查询开销

每次运行查询时sqlserver将查询语句分解成各个部分，然后将他发送到查询优化器

‍

## 第6章 约束

聚合函数，，就是好几条数据聚在一起且合并计算的函数Group by

将维护数据完整性的责任移到数据库本身是数据库管理的一场革命，主要通过（约束，触发器，数据类型）

![](22f920985ab4efa10c77c70ccb9831d7-20220205112518-qr56etx.png)

![](e9bbd70b52c810757c4c0d5b2f4c10bc-20220205112518-vumxfcv.png)

![](d201b91978080fb4565853d5ef4284cd-20220205112518-uqzw5ox.png)![](78f956732dab0c63dc5c2175aa95096f-20220205112518-dywlwnw.png)

主键 Primary Key

外键 Foreign Key 技能确保数据完整性，又能体现表之间的关系

唯一约束

check

default,, insert中使用，delete和update中不使用

![](7686d2867ec7a620c44e343ed75e7999-20220205112518-xafvoof.png)

## 第7章 复杂查询

‍

![](d1ff9b4ca286165c90fae50339eaea36-20220205112717-ni70m38.png)

![](f8540f6cffcef027db1f941f613f9385-20220205112717-6uz2xtd.png)

1.嵌套子查询

![](8cc0d040c8e5e27fc03620f4054fc064-20220205112717-3ph6x7w.png)

![](e7dacc86a689c27b51d93e701c871ce3-20220205112717-6eudzfb.png)

2.关联子查询

![](0c3f96e66efa8e4eb72db8f1e0e1c60a-20220205112717-th676gd.png)

创建临时表=创建表进行连接然后drop掉

在select列表中关联关联子查询

![](1aac23d826321755252d89c934a3eef1-20220205112717-v8y0hqy.png)

函数isnull, cast,convert

**3.派生表**

![](179cdc6b4f1f55b077183e3c249e40f6-20220205112717-u780cmv.png)

![](adc526121eb10ea48d367292bae447b2-20220205112717-3dqav4i.png)

![](57f09737c85d448285fbb67ae730dcbc-20220205112717-ndf2vwk.png)

**4.Exists运算符**

![](d05e9441969afc0f8145048587fe3340-20220205112717-kb0smgu.png)

![](b7b5d8def85f0bbb85ac1d117e5d438e-20220205112717-tczrfw1.png)

![](76ee34ccc1babcc09924b0ea4069ba9f-20220205112717-bxhnm60.png)

**5.Merge**

![](ba3b3e74062575f2830b41061178800c-20220205112717-4qozt3f.png)

![](c1fc91240eb4f4798de626a27ff33572-20220205112717-6ueuc52.png)

‍

## 第8章 范式

![](4aac0d673ee03146f3e57329d3623504-20220205112810-gfxpn83.png)

**1.先决条件 实体=对象**

![](3dba71ea3da8ae18ca7a47fcadd8c02e-20220205112810-s2xp8g7.png)

**2.第一范式**

![](8efb5d84e2d13377d59ea649d2bd26c6-20220205112810-ms9a6jl.png)

**3.第二范式**

![](67b6a73ee77f033a8d1de8d5c91f40ca-20220205112810-5x8d97t.png)

将不符合第二范式的表分成表头和细节表，

表头包含的信息只需要存储一次，细节表包含了大部分列和所有的行，表头是俩个有关系表中父表的一部分

对每个表头记录，通常至少有一个细节记录，也可以有多个，

![](93f48f80f996ea5c1457c025afb08f93-20220205112810-wjdrwzu.png)

细节表

![](6d71ad838e2a9f9a83aef435697541b8-20220205112810-o0zpqfm.png)

表头

![](07d47eea1af3c391de8b73e12dbf1838-20220205112810-zyzxady.png)

**4.第三范式**

**使表中所有列不仅仅是依赖于某个事物而是要依赖于正确的事物**

![](e08be6797aa2e7c2ff89c1d525f4c214-20220205112810-lidatq6.png)

不同的主键是不同的实体，有外键的俩个表之间应属于同一实体，只是为了满足第三范式

派生数据就是没必要的数据，，比如计算可以求得的数据。

![](a3203a06b49248e7f3b5d92e5aa857ca-20220205112810-wajymgp.png)

**5.关系**

一对一

![](55c28925d9241e7d9a733d8619603de4-20220205112810-hg6fwri.png)

**零或一对一**

![](55c848a9c101d28ad2ac286cbeab43d5-20220205112810-1uqdb9v.png)

**一对一，或一对多，这是一种常见的外键关系，通过以表头/细节表的关系出现**

![](baf48fba99da08827b0cc051f05ae63d-20220205112810-t06freu.png)

一对零，一对一或一对多关系

![](cfb910a85b86ed8b7d83c793776dfa21-20220205112810-ys5xmno.png)

![](e649aaa2b8f431bfa9d1b290685aa6ff-20220205112810-viswecl.png)

多对多

![](67fb9e745f23f77f94a263f64c590994-20220205112810-ygts9bg.png)

**数据库关系图是一个sqlserver提供的工具**

**表设计器**

![](b720d42c645a6f97c2f8875e4407b011-20220205112810-fy2fmpb.png)

exec sp_help DbActivity

6.反规范化

规范化有时候会成为数据库设计者佩戴的十字架，会变成他们的信仰，他们是为了规范化而规范化数据而不是为了数据库的实用性。

![](fb51f51a96b4e37f9b68146f45591b3c-20220205112810-jyseour.png)

![](287693e7d3c9e2d8d6ef6b7bd33bdf0a-20220205112810-mjyuo4s.png)

7.保持简单，选择数据类型，尽量进行存储

‍

## 第9章 存储和索引结构

**1.存储**​******数据库******​**区段**

![](90224ed38509c95270b06fca44b91fae-20220205112851-zafo7w1.png)

**页**

![](27a044e0a26cac07d8feb4dd78f94137-20220205112851-ciqcoff.png)

![](4d0ff6cd36f3487c47539ebf93dec633-20220205112851-c6btv8a.png)

**行**

![](6e95523b839911fd8856f8151db58c10-20220205112851-1br2uof.png)

**稀疏列**

![](5fb526412c307b153af6d9015b58e248-20220205112851-sdjqh4b.png)

2.索引

B+树，叶节点可从中获取对实际物理数据的引用的节点，非叶节点可以指向其他非叶结点或叶结点

一个结点一个页，，B+树自平衡，

故添加数据的时候可能会出现页拆分

![](88180e1a1818791dd5467571588dc013-20220205112851-ks3rkmn.png)

**3.数据的检索**

![](d33f085ee7e2263721a3b11bbd82570b-20220205112851-qdgxai8.png)

xml索引

![](20034cff0d71c6b6af1e8cdea9100528-20220205112851-w54g8wr.png)

![](ba7081e79e05261d17f062562bf28c88-20220205112851-wk9x6k4.png)

## 第10章 视图

1.视图作用

![](02eda4e1046922b3021d79f59ef06be5-20220205112917-rvk6d41.png)

![](7c60a453f28760b9f502f71f46d58d24-20220205112917-vuvg81y.png)

![](7336cd49b1612d2b90f3dad7f73572aa-20220205112917-dsw3k4b.png)

![](86e1fc2d33ad9f1a73eea4b55d93e916-20220205112917-wbjzh71.png)

**2.使用视图更改数据-不适用instead of  触发器**

![](7fdb74091095c265f0a0e3e6b06c3a9a-20220205112917-no2skdr.png)

![](489f8ef4702ce4edfda99bb16bad1b0f-20220205112917-x6an3d3.png)

![](9ec642c10d60fb7a43a624143f365082-20220205112917-cp0kj9i.png)

3，加密视图需要用到With encryption

4. 模式绑定

![](111cb018e711f5cebe2bfea1d04c10a5-20220205112917-r75g78g.png)

5.索引视图

![](88dae48b4408f210fda2b6adcc736936-20220205112917-rtdr6vx.png)

## 第11章 sql脚本和批处理

** 1. use****  declare @ident int; 必须初始化变量，否则为Null，直到显式地将其设置为其他一些值。**

**select或者set设置变量的值**

使用set,不能将查询得到的值赋给变量，必须将查询和set分开

![](75ee3b6c295d25d9d4bda31c23df6ba8-20220205112940-rkovm2g.png)

![](d79b3f44c5225722e990214bc97a7eec-20220205112940-o8whpty.png)

![](9fe0455943379d08e355c8b1253535ef-20220205112940-nvrjg7n.png)

![](913048ae5358832d6bf3d252131e764a-20220205112940-2bireuc.png)

2.系统函数

![](e00fc440fac269a773075176a8a655c9-20220205112940-frsl8xq.png)

![](c1c9b5cec4466a5c591e35dc0726b1b3-20220205112940-2ynhdr4.png)

@@rowcount 影响了多少行

3.批处理

![](d383484c91f2f3578303f74e28e04cdf-20220205112940-te8fg4d.png)

![](177e2964621b525748d7eb19049861fe-20220205112940-l51mj6q.png)

![](76aa36874ee95abe29ca2220db796368-20220205112940-zgpgx31.png)

4.动态SQL：用exec命令动态生成代码

5控制流语句

![](8ccc25123a61eee04f832b32f5f49343-20220205112940-lafetzd.png)

if @ident is null √

if @ident = null ×

Begin End 将代码组合成块

case when... then...  when ...then... else... end

case sth when then else end

while语句循环

waitfor

![](99235ea163dc6b416bd5bfc4f4587291-20220205112940-sio5a2h.png)

Begin try

End try

Begin catch

End catch

## 第12章 存储过程

alter修改存储过程=drop + create 重建权限

return 返回值

创建输出参数 output关键字

错误处理

存储过程的优点

![](c43d0cb83f94c30a5993761a9d996edf-20220205113043-hi71abe.png)

调试

## 第13章  用户自定义函数

![](636de271ba5f23903493c78dca4de46f-20220205113110-rmx8ajh.png)

UDF提供代码的灵活性

存储过程可以传入也可以传出参数

可以返回值指示成功失败而非返回数据

可以返回结果集（插入到临时表中）

![](f351eb54cc72dd7c9c120bfe3d79a6cd-20220205113110-osszaxu.png)

![](99193b7330f42015911c20fcb860a7bc-20220205113110-cgc8a28.png)

